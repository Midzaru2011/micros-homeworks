# Домашнее задание к занятию «Микросервисы: подходы»

Вы работаете в крупной компании, которая строит систему на основе микросервисной архитектуры.
Вам как DevOps-специалисту необходимо выдвинуть предложение по организации инфраструктуры для разработки и эксплуатации.


## Задача 1: Обеспечить разработку

Предложите решение для обеспечения процесса разработки: хранение исходного кода, непрерывная интеграция и непрерывная поставка. 
Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.

Решение должно соответствовать следующим требованиям:
- облачная система;
- система контроля версий Git;
- репозиторий на каждый сервис;
- запуск сборки по событию из системы контроля версий;
- запуск сборки по кнопке с указанием параметров;
- возможность привязать настройки к каждой сборке;
- возможность создания шаблонов для различных конфигураций сборок;
- возможность безопасного хранения секретных данных (пароли, ключи доступа);
- несколько конфигураций для сборки из одного репозитория;
- кастомные шаги при сборке;
- собственные докер-образы для сборки проектов;
- возможность развернуть агентов сборки на собственных серверах;
- возможность параллельного запуска нескольких сборок;
- возможность параллельного запуска тестов.

Обоснуйте свой выбор.

## Ответ

В современных реалиях есть огромное колличество различных технологических решений для организации CI/CD конвейера, которые удовлетворяют вышеуказынным и прочим требованиям. При этом,  стоит обратить внимание на проверенные и широко используемые, так как это дает возможность получить больше информации и перенять полученный другими командами практический опыт. Пожалуй стоит выделить самые часто используемые из них:

- **Jenkins**  - бесплатный инструмент автоматизации с открытым исходным кодом, написанный на Java, с плагинами, созданными для непрерывной интеграции и непрерывной доставки. Jenkins позволяет разворачивать собственные агенты  как на локальных, так и на облачных серверах,  при этом обеспечивая параллельность выполнения заданий. Принцип непрерывной интеграции достигается с помощью плагинов. Плагины позволяют интегрировать различные этапы DevOps. Наиболее популярные плагины, с помощью которых закрывается большая часть задач:

    *a*. Плагин Git - упрощает выполнение основных функций git для проектов - извлечение, выборка, ветвление, объединение, отправка и другие
  
    *b*. Плагин Kubernetes - интегрирует Jenkins с Kubernetes. Он позволяет разработчикам автоматизировать процесс масштабирования при запуске подчиненных устройств Jenkins в среде     Kubernetes

    *c*. Плагин SonarQube - позволяет легко интегрировать SonarQube с Jenkins. SonarQube - это инструмент с открытым исходным кодом для непрерывного контроля качества кода

    *d*. Плагин Docker -  один из лучших плагинов Jenkins для DevOps. Этот плагин позволяет создавать контейнеры Docker и автоматически запускать сборки на них

    *e*. Плагин BlueOcean - плагин улучшающий взаимодействие с пользователем, устраняя беспорядок и улучшая видимость происходящих процессов.

- **GitLab CI/CD** - мощный инструмент построения автоматического процесса разработки, тестирирования и развертывания. Можно выделить наиболее явные плюсы использования данного ПО.
    - Самым большим преимуществом GitLab CI/CD является его гибкость. Инструмент CI/CD работает со всеми ведущими языками и платформами и может быть настроен в соответствии с уникальными потребностями команды разработчиков. GitLab CI/CD также безопасен благодаря функциям сканирования контейнеров и зависимостей, отчетам о тестировании безопасности и т. д.
    - Качество кода разработчика также можно улучшить с помощью GitLab CI/CD. Функция «Качество кода» гарантирует, что  код будет кратким, удобочитаемым и не требует обслуживания, насколько это возможно, а инструмент помогает программистам обнаруживать ошибки и другие проблемы, прежде чем переходить к рабочей среде. И хотя GitLab CI/CD имеет множество функций, одной из самых важных является простота использования этого инструмента, в отличии от Jenkis, для которого требуеться значительно попыхтеть с настройкой необходимых плагинов.
    - GitLab CI/CD позволяет запускать сборки и тестирование параллельно, что обеспечивает оптимизацию времени выполнения процесса CI/CD, позволяет настроить автоматические сборки для каждого изменения в репозитории (CI), а также тестирование и развертывание (CD).
    - Сборки могут быть запущены по событию из системы контроля версий (например, новый коммит) или по кнопке с указанием параметров, а поддержка системы контроля версий Git, позволяет создавать для каждого сервиса отдельный репозиторий.
    - Легкость интеграции с Docker обеспечивает возможность создания собственных докер образов и размещения их в собственном docker registry.
    - Поддержка интеграции с Vault Hashicorp обеспечивает надежное хранение и быструю передачу секретных данных.
    - Развертывание агентов (runners) на собственных серверах, позволяет более гибко настроить и управлять процессом запуска сборок.
    - Возможность создания Issues list, что позволяет команде эффективнее взаимодейтствовать в процессе работы над задачами
    - Широкое примение на различных проектах, создало большое сообщество участников, общение между которомы позволяет решить значительно колличество проблем в настройке и использовании продукта.
 
Считаю, что наиболее удобным и быстрым решениям для создания CI/CD конвейера на проекте, было бы использование GitLab CI/CD, который содержит в себе все необходимые для этого инструменты, удовлетворяет требованиям облачной системы, системы контроля версий Git, автоматических сборок, кастомных настроек и безопасного хранения секретных данных (используя Vault Hashicorp).
       
## Задача 2: Логи

Предложите решение для обеспечения сбора и анализа логов сервисов в микросервисной архитектуре.
Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.

Решение должно соответствовать следующим требованиям:
- сбор логов в центральное хранилище со всех хостов, обслуживающих систему;
- минимальные требования к приложениям, сбор логов из stdout;
- гарантированная доставка логов до центрального хранилища;
- обеспечение поиска и фильтрации по записям логов;
- обеспечение пользовательского интерфейса с возможностью предоставления доступа разработчикам для поиска по записям логов;
- возможность дать ссылку на сохранённый поиск по записям логов.

Обоснуйте свой выбор.

## Ответ

Наверно наиболее подходящим выбором относительно предъявляемых требований, будет широко известный и хорошо зарекомендовавший себя stack ELK - Elastic, Logstash, Kibana. 

Elasticsearch: Центральное хранилище данных и мощный поисковый и аналитический движок. Elasticsearch может хранить и индексировать большие объемы данных и обеспечивает эффективный поиск и фильтрацию логов.

Logstash: Инструмент для сбора, обработки и отправки логов и других данных в Elasticsearch. Logstash поддерживает сбор логов из различных источников, включая stdout, и обеспечивает структурирование данных перед их отправкой в Elasticsearch.

Kibana: Web-интерфейс для визуализации и анализа данных, хранящихся в Elasticsearch. Kibana предоставляет гибкие инструменты для поиска, фильтрации, визуализации и анализа логов. Разработчики могут использовать Kibana для создания пользовательских дашбордов и запросов к данным.


## Задача 3: Мониторинг

Предложите решение для обеспечения сбора и анализа состояния хостов и сервисов в микросервисной архитектуре.
Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.

Решение должно соответствовать следующим требованиям:
- сбор метрик со всех хостов, обслуживающих систему;
- сбор метрик состояния ресурсов хостов: CPU, RAM, HDD, Network;
- сбор метрик потребляемых ресурсов для каждого сервиса: CPU, RAM, HDD, Network;
- сбор метрик, специфичных для каждого сервиса;
- пользовательский интерфейс с возможностью делать запросы и агрегировать информацию;
- пользовательский интерфейс с возможностью настраивать различные панели для отслеживания состояния системы.

Обоснуйте свой выбор.

## Ответ

Как для монолитной, так и для микросервисной архитектуры, хорошо подойдет широкоизвестный стек node exporter + prometheus + grafana + alertmanager. 

Данное ПО позволяет полностью закрыть требования по обеспечению мониторинга работы системы и бизнес показателей, оповещению об ошибках и авариях, а так же предоставляет удобный  интерфейс для отслеживания тенденции тех или иных событий. Сбор данных происходит по средствам агента node exporter, который устанавливается на требуемый узел и позволяет разработчикам настраивать метрики, которые наиболее подходят для отслеживаемого сервера и сервиса - CPU, RAM, HDD, Network,I/O и другие. Затем Prometheus опрашивает сборщики, что позволяет более детально настроить мониторинг, агрегировать полученную информацию и передать ее в удобночитаемый формат через интерфейс графаны, в виде панелей графиков. 

## Задача 4: Логи * (необязательная)

Продолжить работу по задаче API Gateway: сервисы, используемые в задаче, пишут логи в stdout. 

Добавить в систему сервисы для сбора логов Vector + ElasticSearch + Kibana со всех сервисов, обеспечивающих работу API.

### Результат выполнения: 

docker compose файл, запустив который можно перейти по адресу http://localhost:8081, по которому доступна Kibana.
Логин в Kibana должен быть admin, пароль qwerty123456.


## Задача 5: Мониторинг * (необязательная)

Продолжить работу по задаче API Gateway: сервисы, используемые в задаче, предоставляют набор метрик в формате prometheus:

- сервис security по адресу /metrics,
- сервис uploader по адресу /metrics,
- сервис storage (minio) по адресу /minio/v2/metrics/cluster.

Добавить в систему сервисы для сбора метрик (Prometheus и Grafana) со всех сервисов, обеспечивающих работу API.
Построить в Graphana dashboard, показывающий распределение запросов по сервисам.

### Результат выполнения: 

docker compose файл, запустив который можно перейти по адресу http://localhost:8081, по которому доступна Grafana с настроенным Dashboard.
Логин в Grafana должен быть admin, пароль qwerty123456.

---

### Как оформить ДЗ?

Выполненное домашнее задание пришлите ссылкой на .md-файл в вашем репозитории.

---
